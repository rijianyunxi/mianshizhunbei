{
  "version": 3,
  "sources": ["../packages/shared/src/utils/is.ts", "../packages/reactivity/src/effect.ts", "../packages/reactivity/src/reactiveEffect.ts", "../packages/reactivity/src/baseHandler.ts", "../packages/reactivity/src/reactive.ts", "../packages/reactivity/src/ref.ts", "../packages/reactivity/src/computed.ts"],
  "sourcesContent": ["import { ReactiveFlags } from \"../constants\";\n\n/**\n * \u68C0\u67E5\u4E00\u4E2A\u503C\u662F\u5426\u4E3A\u5BF9\u8C61\u7C7B\u578B\n * \n * \u5728JavaScript\u4E2D\uFF0Ctypeof null === 'object' \u662F\u4E00\u4E2A\u5386\u53F2\u9057\u7559\u95EE\u9898\uFF0C\n * \u56E0\u6B64\u9700\u8981\u989D\u5916\u68C0\u67E5\u503C\u4E0D\u7B49\u4E8Enull\u6765\u786E\u4FDD\u6B63\u786E\u8BC6\u522B\u5BF9\u8C61\n * \n * @param value - \u9700\u8981\u68C0\u67E5\u7684\u4EFB\u610F\u503C\n * @returns \u5982\u679C\u503C\u662F\u5BF9\u8C61\u4E14\u4E0D\u4E3Anull\uFF0C\u5219\u8FD4\u56DEtrue\uFF0C\u5426\u5219\u8FD4\u56DEfalse\n * \n * @example\n * ```typescript\n * isObject({}) // true\n * isObject([]) // true (\u6570\u7EC4\u4E5F\u662F\u5BF9\u8C61)\n * isObject(null) // false\n * isObject(42) // false\n * isObject('string') // false\n * ```\n */\nexport function isObject(value: unknown): value is Record<any, any> {\n    return typeof value === 'object' && value !== null;\n}\n\n\nexport function isFunction(value: unknown): value is Function {\n    return typeof value === 'function';\n}\n\n\n\n\n\n// 2. \u5224\u65AD\u6570\u7EC4\nexport const isArray = Array.isArray\n\n\n\n// 4. \u5224\u65AD\u5B57\u7B26\u4E32\nexport const isString = (val: unknown): val is string => \n  typeof val === 'string'\n\n// 5. \u5224\u65AD Symbol\nexport const isSymbol = (val: unknown): val is symbol => \n  typeof val === 'symbol'\n\n// 6. \u5224\u65AD\u662F\u5426\u4E3A Promise (duck typing: \u6709 .then \u548C .catch \u65B9\u6CD5)\nexport const isPromise = <T = any>(val: unknown): val is Promise<T> => {\n  return isObject(val) && isFunction(val.then) && isFunction(val.catch)\n}\n\n// \u96C6\u5408\u7C7B\u578B\u5224\u65AD \nexport const isMap = (val: unknown): val is Map<any, any> =>\n  toTypeString(val) === '[object Map]'\nexport const isSet = (val: unknown): val is Set<any> =>\n  toTypeString(val) === '[object Set]'\nexport const isDate = (val: unknown): val is Date => \n  toTypeString(val) === '[object Date]'\n\n// \u5224\u65AD\u7EAF\u5BF9\u8C61 \nexport const isPlainObject = (val: unknown): val is object => \n  toTypeString(val) === '[object Object]'\n\n\n\nexport const objectToString = Object.prototype.toString;\n\n\nexport const toTypeString = (value: unknown): string =>\n  objectToString.call(value);\n\n\n\nexport interface Ref<T = any> {\n    value: T;\n    [ReactiveFlags.IS_REF]: boolean; \n}\n\nexport function isRef(r: any): r is Ref {\n    // !! \u662F\u4E3A\u4E86\u8F6C\u6210\u5E03\u5C14\u503C\n    // r && ... \u662F\u4E3A\u4E86\u9632\u6B62 r \u662F null \u62A5\u9519\n    return !!(r && r[ReactiveFlags.IS_REF] === true);\n}\n\nexport function isReactive(value: unknown): boolean {\n    // \u5C1D\u8BD5\u53BB\"\u8BFB\u53D6\"\u8FD9\u4E2A\u7279\u6B8A\u7684\u5C5E\u6027\n    // \u5982\u679C value \u662F\u4E2A\u666E\u901A\u5BF9\u8C61\uFF0C\u8BFB\u53D6\u7ED3\u679C\u662F undefined -> \u8F6C\u6210 false\n    // \u5982\u679C value \u662F\u4E2A Proxy\uFF0C\u8BFB\u53D6\u4F1A\u88AB get \u62E6\u622A -> \u8FD4\u56DE true\n    return !!(value && (value as any)[ReactiveFlags.IS_REACTIVE]);\n}", "import { DirtyLevel } from \"@vue-mini/shared\";\n\n//  \u4F9D\u8D56\u96C6\u5408\u7C7B\u578B\uFF0C \u7EE7\u627F\u81EA Map<ReactiveEffect, ReactiveEffect> \uFF0C \u5E76\u6DFB\u52A0\u4E86 cleanup \u65B9\u6CD5\nexport type Dep = Map<ReactiveEffect, number> & {\n    cleanup?: (dep: Dep) => void;\n    key?: string | symbol;\n    depsMap?: Map<any, any>;\n};\n\n\n/**\n * activeEffect \u662F\u5F53\u524D\u6B63\u5728\u8FD0\u884C\u7684 effect \u5B9E\u4F8B\n * \u5F53 effect \u8FD0\u884C\u65F6\uFF0C\u4F1A\u5C06\u5F53\u524D effect \u5B9E\u4F8B\u8D4B\u503C\u7ED9 activeEffect\n * \u5F53 effect \u8FD0\u884C\u5B8C\u6210\u540E\uFF0C\u4F1A\u5C06 activeEffect \u6062\u590D\u4E3A null\n */\nexport let activeEffect: ReactiveEffect | undefined = undefined;\n/**\n * \u662F\u5426\u9700\u8981\u6536\u96C6\u4F9D\u8D56\n * \u5F53 shouldTrack \u4E3A true \u65F6\uFF0C\u624D\u4F1A\u6536\u96C6\u4F9D\u8D56\n * \u5F53 shouldTrack \u4E3A false \u65F6\uFF0C\u4E0D\u4F1A\u6536\u96C6\u4F9D\u8D56\n */\nexport let shouldTrack = true;\n\n\n\n// \u5B9A\u4E49 Options \u7684\u63A5\u53E3\nexport interface ReactiveEffectOptions {\n    scheduler?: () => void;\n    onStop?: () => void;\n    // \u5982\u679C\u4F60\u8981\u652F\u6301 lazy\uFF0C\u4E5F\u53EF\u4EE5\u52A0\u5728\u8FD9\u91CC\n    lazy?: boolean;\n}\n\nexport interface ReactiveEffectRunner<T = any> {\n    (): T; // \u8C03\u7528\u7B7E\u540D\u4E3A T (\u5373 fn \u7684\u8FD4\u56DE\u503C)\n    effect: ReactiveEffect; // \u6302\u8F7D\u7684 effect \u5B9E\u4F8B\n}\n\n/**\n * \u54CD\u5E94\u5F0Feffect \u51FD\u6570\n * \u7528\u4E8E\u521B\u5EFA\u54CD\u5E94\u5F0Feffect \u5B9E\u4F8B\n * 1. \u6536\u96C6\u4F9D\u8D56\n * 2. \u89E6\u53D1\u66F4\u65B0\n * 3. \u505C\u6B62\u4F9D\u8D56\u6536\u96C6\n */\nexport function effect<T = any>(\n    fn: () => T,\n    options?: ReactiveEffectOptions\n): ReactiveEffectRunner<T> {\n\n    // \u6216\u8005\u6309\u4F60\u7684\u4EE3\u7801\u903B\u8F91\uFF08\u6CE8\u610F\uFF1A\u901A\u5E38 scheduler \u662F\u901A\u8FC7 options \u4F20\u8FDB\u53BB\u7684\uFF0C\u800C\u4E0D\u662F\u5199\u6B7B\u5728\u6784\u9020\u51FD\u6570\u91CC\uFF09\n    const _effect = new ReactiveEffect(fn, () => {\n        _effect.run();\n    });\n\n    // \u5408\u5E76\u9009\u9879\n    if (options) {\n        Object.assign(_effect, options);\n    }\n\n    // \u9ED8\u8BA4\u6267\u884C\u4E00\u6B21 (\u9664\u975E options.lazy \u4E3A true\uFF0C\u8FD9\u91CC\u6309\u4F60\u7684\u903B\u8F91\u5148\u76F4\u63A5\u6267\u884C)\n    _effect.run();\n\n    // bind \u8FD4\u56DE\u7684\u662F\u4E00\u4E2A\u666E\u901A\u51FD\u6570\uFF0C\u6211\u4EEC\u9700\u8981\u65AD\u8A00\u5B83\u662F ReactiveEffectRunner\n    const runner = _effect.run.bind(_effect) as ReactiveEffectRunner<T>;\n\n    // \u6302\u8F7D effect \u5B9E\u4F8B\n    runner.effect = _effect;\n\n    return runner;\n}\n\n\n/**\n * \u54CD\u5E94\u5F0Feffect \u7C7B\n * \u7528\u4E8E\u54CD\u5E94\u5F0F\u6570\u636E\u7684\u4F9D\u8D56\u6536\u96C6\u548C\u89E6\u53D1\u66F4\u65B0\n * 1. \u6536\u96C6\u4F9D\u8D56\n * 2. \u89E6\u53D1\u66F4\u65B0\n * 3. \u505C\u6B62\u4F9D\u8D56\u6536\u96C6\n * 4. \u624B\u52A8\u89E6\u53D1\u66F4\u65B0\n */\n\nexport class ReactiveEffect {\n    // \u5F53\u4F5C\u6307\u9488\u6765\u7528\uFF0C\u65B9\u4FBF\u66FF\u6362\u65B0\u589E\u6216\u8005\u5220\u9664\u540E\u7EED\u591A\u4F59\u4F9D\u8D56\u7684\u5220\u9664\n    public _depsLength: number = 0;\n    /**\n     * \u4F9D\u8D56\u6536\u96C6\u7684id\uFF0C\u4F5C\u4E3A\u5224\u65AD\u5F53\u6B21run\u8FD8\u662F\u76D1\u542C\u5230set\u540E\u540E\u7684\u91CD\u65B0run\u6536\u96C6\n     * \u521D\u59CB\u503C\u4E3A 0\uFF0C \u6BCF\u6B21run\u6267\u884C\u5C06effect._trackId \u52A0 1\uFF0C \u7528\u4E8E\u89E6\u53D1\u66F4\u65B0\u65F6\uFF0C\u5224\u65AD\u662F\u5426\u9700\u8981\u89E6\u53D1\u66F4\u65B0\n     * \u4E3B\u8981\u662F\u6765\u5224\u65AD\u4E00\u4E2Aeffect\u91CC\u7684\u591A\u4E2A\u91CD\u590D\u4F9D\u8D56\uFF0C\u907F\u514D\u91CD\u590D\u6536\u96C6\n     */\n    public _trackId: number = 0;\n    /**\n     * \u4F9D\u8D56\u6536\u96C6\u7684 dirtyLevel \uFF0C \u7528\u4E8E\u5224\u65AD\u662F\u5426\u9700\u8981\u89E6\u53D1\u66F4\u65B0\n     * \u521D\u59CB\u503C\u4E3A 0\uFF0C \u6BCF\u6B21run\u6267\u884C\u5C06effect._dir \u52A0 4\uFF0C \u7528\u4E8E\u89E6\u53D1\u66F4\u65B0\u65F6\uFF0C\u5224\u65AD\u662F\u5426\u9700\u8981\u89E6\u53D1\u66F4\u65B0\n     * \u4E3B\u8981\u662F\u6765\u5224\u65AD\u4E00\u4E2Aeffect\u91CC\u7684\u591A\u4E2A\u91CD\u590D\u4F9D\u8D56\uFF0C\u907F\u514D\u91CD\u590D\u6536\u96C6\n     */\n    public _dirtyLevel: number = DirtyLevel.DIRTY;\n    // \u4F9D\u8D56\u96C6\u5408\uFF0C \u7528\u4E8E\u5B58\u50A8\u6240\u6709\u4F9D\u8D56\u8BE5\u5C5E\u6027\u7684effect\n    public deps: Dep[] = [];\n    public active: boolean = true;\n    public onStop?: () => void;\n    constructor(public fn: () => void, public scheduler?: () => void) {\n        this.fn = fn;\n        this.scheduler = scheduler;\n    }\n\n    public get dirty() {\n        return this._dirtyLevel === DirtyLevel.DIRTY;\n    }\n\n    public set dirty(value: boolean) {\n        this._dirtyLevel = value ? DirtyLevel.DIRTY : DirtyLevel.NO_DIRTY;\n    }\n    \n    run() {\n        // \u6BCF\u6B21run\u6267\u884C\u5C06effect._dirtyLevel \u52A0 4\uFF0C \u7528\u4E8E\u89E6\u53D1\u66F4\u65B0\u65F6\uFF0C\u5224\u65AD\u662F\u5426\u9700\u8981\u89E6\u53D1\u66F4\u65B0\n        // this._dirtyLevel += DirtyLevel.DIRTY;\n        this._dirtyLevel = DirtyLevel.NO_DIRTY;\n        if (!this.active) {\n            return this.fn();\n        }\n        // \u7F13\u5B58\u5F53\u524D\u7684activeEffect \uFF0C\u6700\u540E\u6062\u590D, \u9632\u6B62\u5D4C\u5957effect \u65F6\uFF0C\u5185\u5C42effect \u8986\u76D6\u5916\u5C42effect\n        let lastActiveEffect = activeEffect;\n        try {\n            activeEffect = this;\n            preClearnEffect(this);\n            return this.fn();\n        } finally {\n            postCleanEffect(this);\n            activeEffect = lastActiveEffect;\n        }\n    }\n\n    stop() {\n        if (this.active) {\n            this.active = false;\n            // this.depsMap.forEach(dep => {\n            //     dep.delete(this);\n            // });\n        }\n    }\n}\n\n\n// \u8F85\u52A9\u51FD\u6570\uFF1A\u5224\u65AD\u662F\u5426\u9700\u8981\u6536\u96C6\nexport function isTracking() {\n    return shouldTrack && activeEffect !== undefined;\n}\n\n\n// \u6536\u96C6\u4F9D\u8D56\nexport function trackEffects(dep: Dep) {\n    // \u5F53 activeEffect \u4E3A undefined \u65F6\uFF0C\u8BF4\u660E\u5F53\u524D\u6CA1\u6709\u8FD0\u884C\u4E2D\u7684 effect\uFF0C\u65E0\u9700\u6536\u96C6\u4F9D\u8D56\n    if (activeEffect === undefined) {\n        return;\n    }\n    // \u6839\u636E\u5F53\u524Deffect\u7684_trackId \u5224\u65AD\u662F\u5426\u9700\u8981\u662F\u5426\u4E3A\u540C\u4E00\u6B21key\u7684\u4F9D\u8D56\u6536\u96C6\uFF0C\u76F8\u540C\u7684\u8BDD\u8868\u793A\u91CD\u590D\u6536\u96C6\uFF0C\u65E0\u9700\u5904\u7406\n    if (dep.get(activeEffect) !== activeEffect._trackId) {\n        // \u4E0D\u540C\u7684\u8BDD\u8868\u793A\u4E3A\u65B0\u7684\u4F9D\u8D56\u6536\u96C6\uFF0C\u9700\u8981\u6DFB\u52A0\u5230\u4F9D\u8D56\u96C6\u5408\u4E2D\u6216\u8005\u66FF\u6362\u65E7\u7684\u4F9D\u8D56\u7684_trackId\u66F4\u65B0\n        dep.set(activeEffect, activeEffect._trackId);\n        // \u4ECEdeps\u53D6\u5230\u5F53\u524Ddeps _depsLength\u4F4D\u7F6E\u7684\u4F9D\u8D56\uFF0C\u4E0E\u65B0\u7684\u4F9D\u8D56\u8FDB\u884C\u6BD4\u8F83\n        let oldDep = activeEffect.deps[activeEffect._depsLength];\n\n        if (oldDep !== dep) {\n            cleanDepEffect(activeEffect, oldDep);\n\n            activeEffect.deps[activeEffect._depsLength++] = dep;\n        } else {\n            activeEffect._depsLength++;\n        }\n    }\n}\n\n\n/**\n * \n * @param effect \n * \u6BCF\u6B21run\u6267\u884C\u5C06effect._depsLength \u91CD\u7F6E\u4E3A 0\uFF0C \u5E76\u5C06effect._trackId \u52A0 1\n * \u7528\u4E8E\u89E6\u53D1\u66F4\u65B0\u65F6\uFF0C\u5224\u65AD\u662F\u5426\u9700\u8981\u89E6\u53D1\u66F4\u65B0 \n */\nfunction preClearnEffect(effect: ReactiveEffect) {\n    effect._depsLength = 0;\n    effect._trackId++;\n}\n\n\nfunction cleanDepEffect(effect: ReactiveEffect, dep: Dep) {\n    if (dep) {\n        dep.delete(effect);\n        if (dep.size === 0) {\n            dep.cleanup?.(dep);\n        }\n    }\n}\n\nfunction postCleanEffect(effect: ReactiveEffect) {\n    if (effect.deps.length > effect._depsLength) {\n        for (let i = effect._depsLength; i < effect.deps.length; i++) {\n            cleanDepEffect(effect, effect.deps[i]);\n        }\n        effect.deps.length = effect._depsLength;\n    }\n}\n\n// \u89E6\u53D1\u4F9D\u8D56\u66F4\u65B0\nexport function triggerEffects(dep: Dep) {\n    for (const effect of dep.keys()) {\n\n        if (effect._dirtyLevel < DirtyLevel.DIRTY) {\n            effect._dirtyLevel = DirtyLevel.DIRTY;\n        }\n\n        if (effect !== activeEffect) {\n            if (effect.scheduler) {\n                effect.scheduler();\n            } else {\n                effect.run();\n            }\n        } else {\n            console.warn('vue3-mini  \u5FAA\u73AF\u4F9D\u8D56');\n        }\n    }\n}", "import { activeEffect, ReactiveEffect, trackEffects, triggerEffects } from \"./effect\";\nimport type { Dep } from \"./effect\";\n/**\n * \u76EE\u6807\u5BF9\u8C61 -> \u952E -> \u4F9D\u8D56\u96C6\u5408\n * \u6BCF\u4E2A\u5C5E\u6027\u5BF9\u5E94\u4E00\u4E2A\u4F9D\u8D56\u96C6\u5408\uFF0C\u96C6\u5408\u4E2D\u5B58\u653E\u6240\u6709\u4F9D\u8D56\u8BE5\u5C5E\u6027\u7684effect\n * \u53CC\u6620\u5C04\uFF0C\u5B9E\u73B0\u76EE\u6807\u5BF9\u8C61 -> \u952E -> \u4F9D\u8D56\u96C6\u5408\u7684\u6620\u5C04\uFF0C\u5747\u4E3AMap\n */\nconst targetMap = new Map();\n\nexport function track(target: object, key: string | symbol) {\n    if (activeEffect) {\n        let depsMap = targetMap.get(target)\n        if (!depsMap) {\n            depsMap = new Map();\n            targetMap.set(target, depsMap);\n        }\n        let dep: Dep = depsMap.get(key);\n        if (!dep) {\n            // \u521B\u5EFA dep\n            // dep = createDep(() => {\n            //     depsMap.delete(key);\n            // }) as Dep;\n            dep = createDep() as Dep;\n            // // === \u6838\u5FC3\u4F18\u5316 === \n            // \u4E0D\u4F20\u95ED\u5305\uFF0C\u800C\u662F\u628A\u5FC5\u8981\u7684\u4E0A\u4E0B\u6587\u6302\u8F7D\u5230 dep \u5BF9\u8C61\u4E0A\n            dep.depsMap = depsMap;\n            dep.key = key;\n            dep.cleanup = finalizeDepCleanup; // \u6240\u6709 dep \u5171\u7528\u540C\u4E00\u4E2A\u51FD\u6570\u5F15\u7528\uFF01\n            depsMap.set(key, dep);\n        }\n        trackEffects(dep);\n\n        console.log('targetMap', targetMap);\n\n    }\n}\n\n\n// \u5B9A\u4E49\u4E00\u4E2A\u901A\u7528\u7684\u6E05\u7406\u51FD\u6570 (\u53EA\u521B\u5EFA\u4E00\u6B21\uFF0C\u5168\u5C40\u590D\u7528)\n// \u8FD9\u662F\u4E00\u4E2A\u6CA1\u6709\u95ED\u5305\u7684\u7EAF\u51FD\u6570\uFF0C\u5B83\u53EA\u64CD\u4F5C\u4F20\u5165\u53C2\u6570\nfunction finalizeDepCleanup(dep: Dep) {\n    const { depsMap, key } = dep; // \u4ECE dep \u8EAB\u4E0A\u53D6\u6570\u636E\n    if (depsMap) {\n        depsMap.delete(key);\n    }\n    dep.depsMap = undefined; // \u89E3\u9664\u5F15\u7528\n}\n\nexport function createDep(fn?: () => void) {\n    let dep = new Map<ReactiveEffect, number>() as Dep;\n    dep.cleanup = fn;\n    return dep;\n}\n\n\nexport function trigger(target: object, key: string | symbol, newValue?: any, oldValue?: any) {\n\n    // console.log('trigger=====>', target, key, newValue, oldValue);\n    const depsMap = targetMap.get(target);\n    if (!depsMap) {\n        return;\n    }\n    const dep:Dep = depsMap.get(key);\n    if (!dep) {\n        return;\n    }\n    triggerEffects(dep);\n    \n\n\n\n\n}", "import { reactive } from './reactive';\nimport { track, trigger } from './reactiveEffect';\nimport { isObject,ReactiveFlags } from \"@vue-mini/shared\";\n\nexport const baseHandler: ProxyHandler<object> = {\n        get(target, key, receiver) {\n            // console.log('proxy data get=====>',key, ':', value);\n            if (key === ReactiveFlags.IS_REACTIVE) {\n                return true;\n            }\n            track(target, key);\n            const res = Reflect.get(target, key, receiver);\n            if (isObject(res)) {\n                return reactive(res);\n            }\n            \n            return res;\n        },\n        set(target, key, value, receiver) {\n            // console.log('proxy data set=====>',key, ':', value);\n            const oldValue = Reflect.get(target, key, receiver);\n            const res = Reflect.set(target, key, value, receiver);\n            if (oldValue !== value) {\n                trigger(target, key,value,oldValue);\n            }\n            return res;\n        }\n    }", "import { isObject } from \"@vue-mini/shared\";\nimport { baseHandler } from \"./baseHandler\";\nimport { ReactiveFlags } from \"@vue-mini/shared\";\nconst reactiveMap = new WeakMap<object, object>();\n\nexport function reactive<T extends object>(target: T): T {\n    const proxy = createReactiveObject(target);\n    return proxy as T;\n}\n\nexport function toReactive<T>(target: T): T {\n    return target ? reactive(target as any) as any : target;\n}\n\n\nfunction createReactiveObject(target: object) {\n    if (!isObject(target)) {\n        return target;\n    }\n    if (reactiveMap.has(target)) {\n        return reactiveMap.get(target)!;\n    }\n    if ((target as any)[ReactiveFlags.IS_REACTIVE]) {\n        return target;\n    }\n    const proxy = new Proxy(target, baseHandler);\n    reactiveMap.set(target, proxy);\n    return proxy;\n}", "import { ReactiveFlags } from \"@vue-mini/shared\";\nimport { trackEffects, isTracking, triggerEffects } from \"./effect\";\nimport type { Dep } from \"./effect\";\nimport { toReactive } from \"./reactive\";\nimport { createDep } from \"./reactiveEffect\";\n\n\n\nexport function ref<T>(value: T): RefImpl<T> {\n    return createRef(value);\n}\n\n\nfunction createRef<T>(value: T): RefImpl<T> {\n    return new RefImpl(value);\n}\n\n\n\nclass RefImpl<T> {\n    public _value: T;\n    public dep?: Dep = undefined;\n    public readonly [ReactiveFlags.IS_REF] = true;\n    constructor(public rawValue: T) {\n        this._value = toReactive(rawValue);\n\n    }\n\n    get value() {\n        trackRefValue(this);\n        return this._value;\n    }\n\n    set value(newValue: T) {\n        if (this.rawValue !== newValue) {\n            this.rawValue = newValue;\n            this._value = toReactive(newValue);\n            triggerRefValue(this);\n        }\n    }\n}\n\n\n\ninterface RefBase {\n    dep?: Dep;\n}\nexport function trackRefValue(ref: RefBase) {\n    if (isTracking()) {\n        if (!ref.dep) {\n            ref.dep = createDep();\n        }\n        trackEffects(ref.dep!);\n    }\n}\n\n\nexport function triggerRefValue(ref: RefBase) {\n    if (ref.dep) {\n        triggerEffects(ref.dep);\n    }\n}\n\n\n\n", "// import { isFunction } from \"@vue-mini/shared\";\nimport { Dep, ReactiveEffect } from \"./effect\";\nimport { trackRefValue, triggerRefValue } from \"./ref\";\n\nexport function computed<T>(getter: () => T): ComputedRefImpl<T> {\n    return new ComputedRefImpl(getter);\n}\n\n\n\nclass ComputedRefImpl<T> {\n\n    public _value!: T;\n    public effect: ReactiveEffect;\n\n    public dep?: Dep;\n    constructor(getter: () => T) {\n        this.effect = new ReactiveEffect(getter, () => {\n            triggerRefValue(this);\n        });\n    }\n\n    get value() {\n        if(this.effect.dirty) {\n            this._value = this.effect.run()!;\n            trackRefValue(this);\n        }\n        return this._value;\n    }\n}"],
  "mappings": "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",
  "names": ["effect", "ref"]
}
