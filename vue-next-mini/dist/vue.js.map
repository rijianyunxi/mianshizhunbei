{
  "version": 3,
  "sources": ["../packages/shared/src/utils/is.ts", "../packages/reactivity/src/effect.ts", "../packages/reactivity/src/reactiveEffect.ts", "../packages/reactivity/src/baseHandler.ts", "../packages/reactivity/src/reactive.ts"],
  "sourcesContent": ["/**\n * \u68C0\u67E5\u4E00\u4E2A\u503C\u662F\u5426\u4E3A\u5BF9\u8C61\u7C7B\u578B\n * \n * \u5728JavaScript\u4E2D\uFF0Ctypeof null === 'object' \u662F\u4E00\u4E2A\u5386\u53F2\u9057\u7559\u95EE\u9898\uFF0C\n * \u56E0\u6B64\u9700\u8981\u989D\u5916\u68C0\u67E5\u503C\u4E0D\u7B49\u4E8Enull\u6765\u786E\u4FDD\u6B63\u786E\u8BC6\u522B\u5BF9\u8C61\n * \n * @param value - \u9700\u8981\u68C0\u67E5\u7684\u4EFB\u610F\u503C\n * @returns \u5982\u679C\u503C\u662F\u5BF9\u8C61\u4E14\u4E0D\u4E3Anull\uFF0C\u5219\u8FD4\u56DEtrue\uFF0C\u5426\u5219\u8FD4\u56DEfalse\n * \n * @example\n * ```typescript\n * isObject({}) // true\n * isObject([]) // true (\u6570\u7EC4\u4E5F\u662F\u5BF9\u8C61)\n * isObject(null) // false\n * isObject(42) // false\n * isObject('string') // false\n * ```\n */\nexport function isObject(value: unknown): value is Record<any, any> {\n    return typeof value === 'object' && value !== null;\n}\n", "\n\n//  \u4F9D\u8D56\u96C6\u5408\u7C7B\u578B\uFF0C \u7EE7\u627F\u81EA Map<ReactiveEffect, ReactiveEffect> \uFF0C \u5E76\u6DFB\u52A0\u4E86 cleanup \u65B9\u6CD5\nexport type Dep = Map<ReactiveEffect, number> & {\n    cleanup?: () => void;\n}\n\n\n/**\n * activeEffect \u662F\u5F53\u524D\u6B63\u5728\u8FD0\u884C\u7684 effect \u5B9E\u4F8B\n * \u5F53 effect \u8FD0\u884C\u65F6\uFF0C\u4F1A\u5C06\u5F53\u524D effect \u5B9E\u4F8B\u8D4B\u503C\u7ED9 activeEffect\n * \u5F53 effect \u8FD0\u884C\u5B8C\u6210\u540E\uFF0C\u4F1A\u5C06 activeEffect \u6062\u590D\u4E3A null\n */\nexport let activeEffect: ReactiveEffect | null = null;\n\n/**\n * \u54CD\u5E94\u5F0Feffect \u51FD\u6570\n * \u7528\u4E8E\u521B\u5EFA\u54CD\u5E94\u5F0Feffect \u5B9E\u4F8B\n * 1. \u6536\u96C6\u4F9D\u8D56\n * 2. \u89E6\u53D1\u66F4\u65B0\n * 3. \u505C\u6B62\u4F9D\u8D56\u6536\u96C6\n */\nexport function effect(fn: () => void, options: object = {}) {\n    const _effect = new ReactiveEffect(fn, () => {\n        _effect.run();\n    });\n    _effect.run();\n}\n\n\n/**\n * \u54CD\u5E94\u5F0Feffect \u7C7B\n * \u7528\u4E8E\u54CD\u5E94\u5F0F\u6570\u636E\u7684\u4F9D\u8D56\u6536\u96C6\u548C\u89E6\u53D1\u66F4\u65B0\n * 1. \u6536\u96C6\u4F9D\u8D56\n * 2. \u89E6\u53D1\u66F4\u65B0\n * 3. \u505C\u6B62\u4F9D\u8D56\u6536\u96C6\n * 4. \u624B\u52A8\u89E6\u53D1\u66F4\u65B0\n */\n\nexport class ReactiveEffect {\n    // \u5F53\u4F5C\u6307\u9488\u6765\u7528\uFF0C\u65B9\u4FBF\u66FF\u6362\u65B0\u589E\u6216\u8005\u5220\u9664\u540E\u7EED\u591A\u4F59\u4F9D\u8D56\u7684\u5220\u9664\n    _depsLength = 0;\n    /**\n     * \u4F9D\u8D56\u6536\u96C6\u7684id\uFF0C\u4F5C\u4E3A\u5224\u65AD\u5F53\u6B21run\u8FD8\u662F\u76D1\u542C\u5230set\u540E\u540E\u7684\u91CD\u65B0run\u6536\u96C6\n     * \u521D\u59CB\u503C\u4E3A 0\uFF0C \u6BCF\u6B21run\u6267\u884C\u5C06effect._trackId \u52A0 1\uFF0C \u7528\u4E8E\u89E6\u53D1\u66F4\u65B0\u65F6\uFF0C\u5224\u65AD\u662F\u5426\u9700\u8981\u89E6\u53D1\u66F4\u65B0\n     * \u4E3B\u8981\u662F\u6765\u5224\u65AD\u4E00\u4E2Aeffect\u91CC\u7684\u591A\u4E2A\u91CD\u590D\u4F9D\u8D56\uFF0C\u907F\u514D\u91CD\u590D\u6536\u96C6\n     */\n    \n    _trackId = 0;\n    // \u4F9D\u8D56\u96C6\u5408\uFF0C \u7528\u4E8E\u5B58\u50A8\u6240\u6709\u4F9D\u8D56\u8BE5\u5C5E\u6027\u7684effect\n    deps: Dep[] = [];\n    fn: () => void;\n    scheduler: () => void;\n    active: boolean = true;\n    constructor(fn: () => void, scheduler: () => void) {\n        this.fn = fn;\n        this.scheduler = scheduler;\n    }\n\n    run() {\n        if (!this.active) {\n            return this.fn();\n        }\n        // \u7F13\u5B58\u5F53\u524D\u7684activeEffect \uFF0C\u6700\u540E\u6062\u590D, \u9632\u6B62\u5D4C\u5957effect \u65F6\uFF0C\u5185\u5C42effect \u8986\u76D6\u5916\u5C42effect\n        let lastActiveEffect = activeEffect;\n        try {\n            activeEffect = this;\n            preClearnEffect(this);\n            return this.fn();\n        } finally {\n            postCleanEffect(this);\n            activeEffect = lastActiveEffect;\n        }\n    }\n\n    stop() {\n        if (this.active) {\n            this.active = false;\n            // this.depsMap.forEach(dep => {\n            //     dep.delete(this);\n            // });\n        }\n    }\n}\n\n/**\n * \n * @param effect \n * \u6BCF\u6B21run\u6267\u884C\u5C06effect._depsLength \u91CD\u7F6E\u4E3A 0\uFF0C \u5E76\u5C06effect._trackId \u52A0 1\n * \u7528\u4E8E\u89E6\u53D1\u66F4\u65B0\u65F6\uFF0C\u5224\u65AD\u662F\u5426\u9700\u8981\u89E6\u53D1\u66F4\u65B0 \n */\nfunction preClearnEffect(effect: ReactiveEffect) {\n    effect._depsLength = 0;\n    effect._trackId++;\n}\n\nfunction cleanDepEffect(effect: ReactiveEffect, dep: Dep) {\n    if (dep) {\n        dep.delete(effect);\n        if (dep.size === 0) {\n            dep.cleanup?.();\n        }\n    }\n}\n\nfunction postCleanEffect(effect: ReactiveEffect) {\n    if (effect.deps.length > effect._depsLength) {\n        for (let i = effect._depsLength; i < effect.deps.length; i++) {\n            cleanDepEffect(effect, effect.deps[i]);\n        }\n        effect._depsLength = effect.deps.length;\n    }\n}\n\nexport function trackEffect(effect: ReactiveEffect, dep: Dep) {\n\n    if (dep.get(effect) !== effect._trackId) {\n\n        dep.set(effect, effect._trackId);\n\n        let oldDep = effect.deps[effect._depsLength];\n\n        if (oldDep !== dep) {\n            cleanDepEffect(effect, oldDep);\n\n            effect.deps[effect._depsLength++] = dep;\n        } else {\n            effect._depsLength++;\n        }\n    }\n\n    console.log('effect', effect);\n\n}\n\n", "import { activeEffect,ReactiveEffect,trackEffect } from \"./effect\";\nimport type { Dep } from \"./effect\";\n/**\n * \u76EE\u6807\u5BF9\u8C61 -> \u952E -> \u4F9D\u8D56\u96C6\u5408\n * \u6BCF\u4E2A\u5C5E\u6027\u5BF9\u5E94\u4E00\u4E2A\u4F9D\u8D56\u96C6\u5408\uFF0C\u96C6\u5408\u4E2D\u5B58\u653E\u6240\u6709\u4F9D\u8D56\u8BE5\u5C5E\u6027\u7684effect\n * \u53CC\u6620\u5C04\uFF0C\u5B9E\u73B0\u76EE\u6807\u5BF9\u8C61 -> \u952E -> \u4F9D\u8D56\u96C6\u5408\u7684\u6620\u5C04\uFF0C\u5747\u4E3AMap\n */\nconst targetMap = new Map();\n\nexport function track(target: object, key: string|symbol) {\n    if (activeEffect) {\n        let depsMap = targetMap.get(target)\n        if(!depsMap) {\n            depsMap = new Map();\n            targetMap.set(target, depsMap);\n        }\n        let dep = depsMap.get(key);\n        if(!dep) {\n            depsMap.set(key, dep = createDep(() => {\n                depsMap.delete(key);\n            }));\n        }\n        trackEffect(activeEffect, dep);\n\n        console.log('targetMap',targetMap);\n        \n    }\n}\n\n\n\n\nfunction createDep(cleanup?: () => void) {\n    const dep = new Map<ReactiveEffect, number>() as Dep;\n    dep.cleanup = cleanup;\n    return dep;\n}\n\n\nexport function trigger(target: object, key: string|symbol,newValue?: any,oldValue?: any) {\n        \n    console.log('trigger=====>', target, key, newValue, oldValue);\n    const depsMap = targetMap.get(target);\n        if(!depsMap) {\n            return;\n        }\n        const dep = depsMap.get(key);\n        if(!dep) {\n            return;\n        }\n        for(const effect of dep.keys()) {\n            if(effect.scheduler) {\n                effect.scheduler();\n            } else {\n                effect.run();\n            }\n        }\n\n        \n}", "import { track, trigger } from './reactiveEffect';\n\nexport const baseHandler: ProxyHandler<object> = {\n        get(target, key, receiver) {\n            // console.log('proxy data get=====>',key, ':', value);\n            if (key === '__v_isReactive') {\n                return true;\n            }\n            track(target, key);\n            const res = Reflect.get(target, key, receiver);\n            return res;\n        },\n        set(target, key, value, receiver) {\n            // console.log('proxy data set=====>',key, ':', value);\n            const oldValue = Reflect.get(target, key, receiver);\n            const res = Reflect.set(target, key, value, receiver);\n            if (oldValue !== value) {\n                trigger(target, key,value,oldValue);\n            }\n            return res;\n        }\n    }", "import { isObject } from \"@vue-mini/shared\";\nimport { baseHandler } from \"./baseHandler\";\nconst reactiveMap = new WeakMap<object, object>();\n\nexport function reactive<T extends object>(target: T): T {\n    const proxy = createReactiveObject(target);\n    return proxy as T;\n}\n\n\nfunction createReactiveObject(target: object) {\n    if (!isObject(target)) {\n        return target;\n    }\n    if (reactiveMap.has(target)) {\n        return reactiveMap.get(target)!;\n    }\n    if ((target as any).__v_isReactive) {\n        return target;\n    }\n    const proxy = new Proxy(target, baseHandler);\n    reactiveMap.set(target, proxy);\n    return proxy;\n}"],
  "mappings": ";AAkBO,SAAS,SAAS,OAA2C;AAChE,SAAO,OAAO,UAAU,YAAY,UAAU;AAClD;;;ACPO,IAAI,eAAsC;AAS1C,SAAS,OAAO,IAAgB,UAAkB,CAAC,GAAG;AACzD,QAAM,UAAU,IAAI,eAAe,IAAI,MAAM;AACzC,YAAQ,IAAI;AAAA,EAChB,CAAC;AACD,UAAQ,IAAI;AAChB;AAYO,IAAM,iBAAN,MAAqB;AAAA;AAAA,EAExB,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOd,WAAW;AAAA;AAAA,EAEX,OAAc,CAAC;AAAA,EACf;AAAA,EACA;AAAA,EACA,SAAkB;AAAA,EAClB,YAAY,IAAgB,WAAuB;AAC/C,SAAK,KAAK;AACV,SAAK,YAAY;AAAA,EACrB;AAAA,EAEA,MAAM;AACF,QAAI,CAAC,KAAK,QAAQ;AACd,aAAO,KAAK,GAAG;AAAA,IACnB;AAEA,QAAI,mBAAmB;AACvB,QAAI;AACA,qBAAe;AACf,sBAAgB,IAAI;AACpB,aAAO,KAAK,GAAG;AAAA,IACnB,UAAE;AACE,sBAAgB,IAAI;AACpB,qBAAe;AAAA,IACnB;AAAA,EACJ;AAAA,EAEA,OAAO;AACH,QAAI,KAAK,QAAQ;AACb,WAAK,SAAS;AAAA,IAIlB;AAAA,EACJ;AACJ;AAQA,SAAS,gBAAgBA,SAAwB;AAC7C,EAAAA,QAAO,cAAc;AACrB,EAAAA,QAAO;AACX;AAEA,SAAS,eAAeA,SAAwB,KAAU;AACtD,MAAI,KAAK;AACL,QAAI,OAAOA,OAAM;AACjB,QAAI,IAAI,SAAS,GAAG;AAChB,UAAI,UAAU;AAAA,IAClB;AAAA,EACJ;AACJ;AAEA,SAAS,gBAAgBA,SAAwB;AAC7C,MAAIA,QAAO,KAAK,SAASA,QAAO,aAAa;AACzC,aAAS,IAAIA,QAAO,aAAa,IAAIA,QAAO,KAAK,QAAQ,KAAK;AAC1D,qBAAeA,SAAQA,QAAO,KAAK,CAAC,CAAC;AAAA,IACzC;AACA,IAAAA,QAAO,cAAcA,QAAO,KAAK;AAAA,EACrC;AACJ;AAEO,SAAS,YAAYA,SAAwB,KAAU;AAE1D,MAAI,IAAI,IAAIA,OAAM,MAAMA,QAAO,UAAU;AAErC,QAAI,IAAIA,SAAQA,QAAO,QAAQ;AAE/B,QAAI,SAASA,QAAO,KAAKA,QAAO,WAAW;AAE3C,QAAI,WAAW,KAAK;AAChB,qBAAeA,SAAQ,MAAM;AAE7B,MAAAA,QAAO,KAAKA,QAAO,aAAa,IAAI;AAAA,IACxC,OAAO;AACH,MAAAA,QAAO;AAAA,IACX;AAAA,EACJ;AAEA,UAAQ,IAAI,UAAUA,OAAM;AAEhC;;;AC9HA,IAAM,YAAY,oBAAI,IAAI;AAEnB,SAAS,MAAM,QAAgB,KAAoB;AACtD,MAAI,cAAc;AACd,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAG,CAAC,SAAS;AACT,gBAAU,oBAAI,IAAI;AAClB,gBAAU,IAAI,QAAQ,OAAO;AAAA,IACjC;AACA,QAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,QAAG,CAAC,KAAK;AACL,cAAQ,IAAI,KAAK,MAAM,UAAU,MAAM;AACnC,gBAAQ,OAAO,GAAG;AAAA,MACtB,CAAC,CAAC;AAAA,IACN;AACA,gBAAY,cAAc,GAAG;AAE7B,YAAQ,IAAI,aAAY,SAAS;AAAA,EAErC;AACJ;AAKA,SAAS,UAAU,SAAsB;AACrC,QAAM,MAAM,oBAAI,IAA4B;AAC5C,MAAI,UAAU;AACd,SAAO;AACX;AAGO,SAAS,QAAQ,QAAgB,KAAmB,UAAe,UAAgB;AAEtF,UAAQ,IAAI,iBAAiB,QAAQ,KAAK,UAAU,QAAQ;AAC5D,QAAM,UAAU,UAAU,IAAI,MAAM;AAChC,MAAG,CAAC,SAAS;AACT;AAAA,EACJ;AACA,QAAM,MAAM,QAAQ,IAAI,GAAG;AAC3B,MAAG,CAAC,KAAK;AACL;AAAA,EACJ;AACA,aAAUC,WAAU,IAAI,KAAK,GAAG;AAC5B,QAAGA,QAAO,WAAW;AACjB,MAAAA,QAAO,UAAU;AAAA,IACrB,OAAO;AACH,MAAAA,QAAO,IAAI;AAAA,IACf;AAAA,EACJ;AAGR;;;ACzDO,IAAM,cAAoC;AAAA,EACzC,IAAI,QAAQ,KAAK,UAAU;AAEvB,QAAI,QAAQ,kBAAkB;AAC1B,aAAO;AAAA,IACX;AACA,UAAM,QAAQ,GAAG;AACjB,UAAM,MAAM,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAC7C,WAAO;AAAA,EACX;AAAA,EACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAE9B,UAAM,WAAW,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAClD,UAAM,MAAM,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AACpD,QAAI,aAAa,OAAO;AACpB,cAAQ,QAAQ,KAAI,OAAM,QAAQ;AAAA,IACtC;AACA,WAAO;AAAA,EACX;AACJ;;;ACnBJ,IAAM,cAAc,oBAAI,QAAwB;AAEzC,SAAS,SAA2B,QAAc;AACrD,QAAM,QAAQ,qBAAqB,MAAM;AACzC,SAAO;AACX;AAGA,SAAS,qBAAqB,QAAgB;AAC1C,MAAI,CAAC,SAAS,MAAM,GAAG;AACnB,WAAO;AAAA,EACX;AACA,MAAI,YAAY,IAAI,MAAM,GAAG;AACzB,WAAO,YAAY,IAAI,MAAM;AAAA,EACjC;AACA,MAAK,OAAe,gBAAgB;AAChC,WAAO;AAAA,EACX;AACA,QAAM,QAAQ,IAAI,MAAM,QAAQ,WAAW;AAC3C,cAAY,IAAI,QAAQ,KAAK;AAC7B,SAAO;AACX;",
  "names": ["effect", "effect"]
}
